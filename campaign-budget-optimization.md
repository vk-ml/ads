# Оптимизация бюджета кампании 

### Задача
**Дано**   

Пусть есть кампания, состоящая из N объявлений, общим дневным бюджетом B и ожидаемой длительностью кампании в днях T. 

Для каждого объявления из кампании требуется найти оптимальную пару (бюджет, ставка) такую, чтобы суммарное число полученных кликов было максимально.

Представьте, что рекламодатель создал два объявление и у него есть 100 рублей. Объявления разные и заранее сложно оценить, какое из них будет эффективнее для рекламодателя и принесет больше дешевых кликов, поэтому непонятно, какой дневной бюджет указать каждому из объявлений. 
Алгоритм должен заметить, что первое объявление работает гораздо круче, но и по второму по низкой ставке можно найти немного хороших кликов. Поэтому результатом алгоритма будет, например, что первое объявление потратило 80 рублей и заработало 16 кликов, а второе – 20 рублей и 4 клика.

### Решения  


* [2018, A Combinatorial-Bandit Algorithm for the Online Joint Bid / Budget Optimization of Pay-per-Click Advertising Campaigns, AAAI](https://www.aaai.org/ocs/index.php/AAAI/AAAI18/paper/download/16819/15953)

Задачу формулирует в терминах задачи оптимизации с ограничениями. Для каждого объявления найти такие оптимальные ставку и бюджет, чтобы максимизировать суммарное взвешенное число кликов всех объявлений.
Данная задача есть не что иное, как задача о рюкзаке с мультивыбором (Multiple-choice Knapsack Problem)
Есть N предметов, у каждого предмета есть стоимость и вес, каждый предмет принадлежит одному из M классов. Выбрать по одному предмету из каждого класса таким образом, чтобы стоимость была максимальна, а суммарный вес не превышал вес рюкзака. 
Проводя аналогию с рюкзаком, предметы это множество всевозможных пар (бюджет, ставка). Стоимость предмета это количество кликов, которые можно получить по заданной ставке и бюджету. Нужно выбрать подмножество пар (бюджет, ставка), где каждая пара принадлежит только одному из объявлений, так чтобы сумма кликов (стоимость предмета) была максимальна, а сумма бюджетов объявлений (вес предмета) меньше бюджета кампании. 
При этом в отличие от задачи о рюкзаке, задача динамична и в течение времени нужно заново выбирать предметы (оптимальные пары (бюджет, ставка)) из каждого класса.

Предлагаемое решение состоит из трех этапов: обновление модели предсказания кликов и выбор оптимальных пар (бюджет, ставка) для каждого объявления.
 
Сначала авторы описывают модель оценки максимального ожидаемого числа кликов и максимального потраченного бюджета по заданной ставке для конкретного объявления.
С помощью оценки этих значений далее авторы рассчитывают ожидаемое число кликов по объявлению по заданной ставке и заданному бюджету с помощью линейной формулы.
Ожидаемое число кликов моделируется с помощью Гауссовского процесса. В первый день задают средние значения, в последующие дни уточняю модель с помощью данных об открутке объявления в предыдущий день. Также в модели есть exploration стадия, которую авторы реализуют с помощью комбинаторных бандитов (combinatorial bandit). 

Выбор оптимальных пар (бюджет, ставка) для каждого объявления осуществляется с помощью динамического программирования, [как в обычном ограниченном рюкзаке](https://neerc.ifmo.ru/wiki/index.php?title=%D0%97%D0%B0%D0%B4%D0%B0%D1%87%D0%B0_%D0%BE_%D1%80%D1%8E%D0%BA%D0%B7%D0%B0%D0%BA%D0%B5#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4_.D0.B4.D0.B8.D0.BD.D0.B0.D0.BC.D0.B8.D1.87.D0.B5.D1.81.D0.BA.D0.BE.D0.B3.D0.BE_.D0.BF.D1.80.D0.BE.D0.B3.D1.80.D0.B0.D0.BC.D0.BC.D0.B8.D1.80.D0.BE.D0.B2.D0.B0.D0.BD.D0.B8.D1.8F_2).
То есть за O(кол-во объявлений * (кол-во вариантов бюджета для объявления)^2).
Также авторы уточняют, что если второй параметр большой, то можно решать эту задачу с помощью [приближенной схемы](https://ru.wikipedia.org/wiki/%D0%97%D0%B0%D0%B4%D0%B0%D1%87%D0%B0_%D0%BE_%D1%80%D1%8E%D0%BA%D0%B7%D0%B0%D0%BA%D0%B5#%D0%9F%D1%80%D0%B8%D0%B1%D0%BB%D0%B8%D0%B6%D0%B5%D0%BD%D0%BD%D0%B0%D1%8F_%D1%81%D1%85%D0%B5%D0%BC%D0%B0_%D0%BF%D0%BE%D0%BB%D0%BD%D0%BE%D1%81%D1%82%D1%8C%D1%8E_%D0%BF%D0%BE%D0%BB%D0%B8%D0%BD%D0%BE%D0%BC%D0%B8%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B3%D0%BE_%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%B8), которая ищет субоптимальное решение за полиномиальное время.

Тестировали на датасете Yahoo! с помощью какого-то симулятора и в течение двух месяцев на реальной кампании в финансовой итальянской кампании.

* [2015, Multi-Touch Attribution Based Budget Allocation
in Online Advertising](https://arxiv.org/pdf/1502.06657.pdf)

Статья от специалистов из Turn Inc. про то, как эффективно распределять бюджет между рекламными кампаниями. Авторы рассказывают о том, как применяет простые решения, которые позволяют учесть атрибуцию рекламных кампаний и добиться максимальной "отдачи от рекламы" в терминах ROI.

В данной работе авторы решают проблему оптимизации рекламного бюджета между рекламными кампаниями. Основные статьи, которые упоминаются в обзоре во многом предполагают управление и ставкой, и бюджетом одновременно. Отличие данной работы заключается в том, что нет управления ставкой объявления. Основная идея алгоритма оптимизации - жадное распределение капитала на основе метрики эффективности ROI (return on investment), учитывающей атрибуцию.

Формулируя более простыми терминами: максимизировать отдачу от всех объявлений так, чтобы суммарный распределенный бюджет на эти объявления не превышал значение, которое способны они потратить.

Решить данную оптимизационную задачу предлагается с помощью следующего жадного алгоритма: пока есть бюджет для распределения, проходим объявления в порядке, начиная с самого эффективного, и отдаем весь бюджет, который кампания способна выкрутить.

[Полный конспект здесь](https://vk.com/@papersreaders-multi-touch-attribution-based-budget-allocation-in-online-ad)

* [2015, Smart Pacing for Effective Online Ad Campaign Optimization, KDD](https://arxiv.org/pdf/1506.05851.pdf)

В статье было предложено жадное итеративное решение. Каждый день на основе показателей прошлого дня (потраченный бюджет, средний CTR, приоритета объявления, вероятности перехода от вставки к показу) обновляются пропорции бюджета между объявлениями. Основной принцип: чем выше CTR, тем выше приоритет объявления и вероятности перехода от вставки к показу у более приоритетных объявлений не может быть меньше, чем у менее приоритетных объявлений.

* [2012, Joint Optimization of Bid and Budget Allocation in Sponsored Search, KDD](http://www0.cs.ucl.ac.uk/staff/Weinan.Zhang/papers/jointopt-kdd.pdf)

В статье данную задачу решали с помощью [последовательного квадратичного программирования](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D1%81%D0%BB%D0%B5%D0%B4%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5_%D0%BA%D0%B2%D0%B0%D0%B4%D1%80%D0%B0%D1%82%D0%B8%D1%87%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5). Авторы сформулировали задачу оптимизации и итеративно решают ее с помощью квадратичного программирования.  


